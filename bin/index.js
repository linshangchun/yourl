"use strict";function n(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var o=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==o)return;var e,a,i=[],r=!0,l=!1;try{for(o=o.call(n);!(r=(e=o.next()).done)&&(i.push(e.value),!t||i.length!==t);r=!0);}catch(n){l=!0,a=n}finally{try{r||null==o.return||o.return()}finally{if(l)throw a}}return i}(n,t)||o(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(n){return function(n){if(Array.isArray(n))return e(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||o(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(n,t){if(n){if("string"==typeof n)return e(n,t);var o=Object.prototype.toString.call(n).slice(8,-1);return"Object"===o&&n.constructor&&(o=n.constructor.name),"Map"===o||"Set"===o?Array.from(n):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(n,t):void 0}}function e(n,t){(null==t||t>n.length)&&(t=n.length);for(var o=0,e=new Array(t);o<t;o++)e[o]=n[o];return e}var a=require("commander"),i=require("shelljs").exec,r=require("open"),l=require("dayjs"),c=require("./utils"),s=c.systemLogo,u=c.systemPkg,d=c.getPackageInfo,f=c.getData,m=c.saveData,p=c.getConf,g=c.saveConf,v=c.activeURL,y=c.uuid_generate,h=c.ylSystem,b=c.ylPath,L=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"item";if(a.commands.map((function(n){return n._name})).includes(n))return console.log("".concat(n,": 该别名为项目保留关键字！请重试")),"tag"===t?[]:null;var o=f();if("tag"===t){var e=o.filter((function(t){var o;return null==t||null===(o=t.tag)||void 0===o?void 0:o.split(",").includes(n)}));return e.length||"tag"!==t||console.log('yl: "not found the tag"'),e}var i=o.find((function(t){return t.alias===n}));return i||"item"!==t||console.log('yl: "not found the URL"'),i&&v(i),i};a.command("add <alias> <url>").description("【yl add <alias> <url>】新增URL").option("-t, --template <template>","模板链接",null).option("-d, --description <description>","描述说明","无").action((function(n,t,o){var e=f();if(L(n,"add"))return console.log("已存在该URL: ".concat(n,"！请重试"));var a={id:y(),alias:n,url:t,template:o.template,description:o.description,createTime:l().format("YYYY-MM-DD HH:mm:ss")};e.unshift(a),m(e)})),a.command("del <alias>").description("【yl del <alias>】删除URL").action((function(n){var t=f();L(n)&&m(t.filter((function(t){return t.alias!==n})))})),a.command("set <alias>").description("【yl set <alias> [-a,-d,-t]】更新URL").option("-a, --alias <alias>","更新别名").option("-d, --description <description>","更新描述").option("-t, --tag <tag>","更新标签").action((function(n,o){var e=f();L(n,"set")&&m(e.map((function(e){if(e.alias===n){e.active=(e.active||0)+1,e.alias=o.alias?o.alias:e.alias,e.description=o.description?o.description:e.description;var a=(e.tag||"").split(","),i=(o.tag||"").split(",").filter((function(n){return Boolean(n)&&" "!==n})).map((function(n){return n.trim()})),r=function(n){return n.lastIndexOf("-")===n.length-1},c=null==i?void 0:i.filter((function(n){return r(n)})).map((function(n){return n.substring(0,n.length-1)})),s=null==i?void 0:i.filter((function(n){return!r(n)})),u=a.filter((function(n){return!c.includes(n)}));e.tag=t(new Set([].concat(t(u),t(s)))).join(","),e.updateTime=l().format("YYYY-MM-DD HH:mm:ss"),console.log("changed-itemAlias: ".concat(e.alias)),console.log("changed-itemDesc: ".concat(e.description)),console.log("changed-itemTag: ".concat(e.tag))}return e})))})),a.command("view <alias>").description("【yl view <alias>】查看URL详情").action((function(n){var t=L(n,"view");t&&(console.log("".concat(t.alias," of info:")),console.log(t))})),a.command("list").alias("ls").description("【yl list】查看URL列表").option("-n, --number <number>","展示数量",6).option("-a, --all [all]","展示所有",!1).action((function(n){var t=f();t.sort((function(n,t){return(t.active||0)-(n.active||0)})).slice(0,n.all?t.length:n.number).map((function(n,t){var o=t>=9?t+1:"0".concat(t+1);return"".concat(o," ").concat(n.alias,"[").concat(n.active||0,"]: ").concat(n.url," 【").concat(n.description,"】")})).forEach((function(n){console.log(n)})),console.log("* * ".repeat(5)),console.log("当前URL总数：".concat(t.length,"\n查看所有URL：-a \n指定展示数量：-n n"))})),a.command("edit [name]").description("【yl edit [data|conf]】查看并编辑数据文件").action((function(n){var t=p().editToolCmd,o={data:b.YOURL_DATA_PATH,conf:b.YOURL_CONF_PATH};o[n]?i("".concat(t," ").concat(o[n]),{silent:!0}):console.log("当前支持数据查看项: data 或 conf")})),a.command("conf").description("【yl conf】系统设置").option("-e, --editToolCmd <editToolCmd>","编辑工具命令").action((function(n){var t=p();n.editToolCmd&&(t.editToolCmd=n.editToolCmd,g(t)),console.log(t)})),a.command("tag <name>").description("【yl tag <name>】标签打开相关URL").action((function(n){var t=L(n,"tag");t.length>0&&t.forEach((function(n){r(n.url)}))})),a.arguments("[args...]").option("-c, --copy [copy]","是否复制",!1).action((function(t,o){if(0===t.length)return console.log(s(h.LOGO)),void console.log(u(d()));var e=n(t,1)[0],a=L(e);a&&r(a.url)})),a.parse(process.argv);
